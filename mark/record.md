



## 一.总线设计

### ICB总线设计

1. 仅有2个独立的通道，读和写操作公用地址通道，共用结果返回通道
2. 与AXI总线一样，采用分离的地址和数据阶段
3. 支持地址区间寻址，支持任意的主从数目
    - 一主一丛
    - 一主多从
    - 多主一从
    - 多主多从
4. 每个读/写操作都会产生地址，而不想AXI中只有起始地址(不支持突发传输)
5. 支持地址非对齐访问，使用掩码控制部分写操作
6. 支持多个置外交易 outstanding transaction
7. 不支持按序返回按序完成，反馈通道必须按照顺序返回结果
8. 非常利于添加流水线级数

### ICB信号

| 通道     | 方向   | 宽度 | 信号名        | 描述                                    |
| -------- | ------ | ---- | ------------- | --------------------------------------- |
| 命令信道 | output | 1    | icb_cmd_valid | 主设备向从设备发出的读/写请求信号       |
| 命令信道 | input  | 1    | icb_cmd_ready | 从设备向主设备返回的读/写接受信号       |
| 命令信道 | output | 1    | icb_cmd_read  | 读信号                                  |
| 命令信道 | output | DW   | icb_cmd_addr  | 读/写地址                               |
| 命令信道 | output | DW   | icb_cmd_wdata | 写数据                                  |
| 命令信道 | output | DW/8 | icb_cmd_wmask | 写操作的字节掩码                        |
| 反馈通道 | input  | 1    | icb_rsp_valid | 从设备向主设备发送的读/写反馈的请求信号 |
| 反馈通道 | output | 1    | icb_rsp_ready | 主设备向从设备发送的读/写反馈的接受信号 |
| 反馈通道 | input  | DW   | icb_rsp_rdata | 读反馈数据                              |
| 反馈通道 | input  | 1    | icb_rsp_err   | 读反馈错误                              |
|          |        |      |               |                                         |

## 二.取指

- 将指令从内存中取出

- 简单译码
- 分支预测
- 暂时不考虑压缩指令

### 简单译码

普通指令或者是分支/跳转指令

- 分支指令: JXX

    pc_next = pc + imm

- 跳转指令: JAL && JALR

    JAL: pc_next = pc + imm

    JALR: pc_next = rs1 + imm

### 分支预测

- BXX指令：采用静态分支预测，向后跳转预测为跳，向前跳转预测为不跳
- JAL：PC + OFFSET
- JALR： RS1 + OFFSET

#### 分支预测操作数

- jal和bxx使用PC作为基地址

- jalr需要使用寄存器中的值作为基地址

  - rs1 = x0

    基地址 = 0

  - rs1 = x1

    x1常用于函数调用的返回地址，可以做特殊优化

  - 其他寄存器

### PC生成

- 顺序取指
- 分支指令
- 流水线冲刷

### 取指令